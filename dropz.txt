// ==UserScript==
// @name         dropz
// @namespace    http://tampermonkey.net/
// @version      2024-08-28
// @description  try to take over the world!
// @author       You
// @match        https://my.dropz.xyz/member/*
// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==
// @grant        GM_xmlhttpRequest
// ==/UserScript==

(function() {
    'use strict';

    // Your code here...
    setInterval(()=>{
     auto();
    },10000);

    setInterval(()=>{
     getCaptchaId();
    },10000);

    setInterval(()=>{
     getCaptchaResponse();
    },10000);

    setInterval(()=>{
     solveCaptcha();
    },10000);
	
	setInterval(()=>{
     clickOther();
    },10000);

})();

var idCaptcha = '';
function auto(){
    console.log("auto");
    var targetNode = document.querySelector("button[class='btn btn-info btn-sm mt-3 mb-4']");
    if (targetNode) {
        console.log(targetNode.innerText);
        if(targetNode.innerText.trim() === 'Visit Website'){
            console.log('click');
            triggerMouseEvent (targetNode, "mouseover");
            triggerMouseEvent (targetNode, "mousedown");
            triggerMouseEvent (targetNode, "mouseup");
            triggerMouseEvent (targetNode, "click");
        }
    }
    else{
        console.log ("*** Target node not found!");
    }

    return;
    //setTimeout(auto(), 20000);
}
var profile = '';
function getCaptchaId(){
    var hcaptchaNode = document.querySelector("textarea[name='h-captcha-response']");
    if (hcaptchaNode){
        console.log('get captcha Id');
         if(idCaptcha === ''){
             console.log('send captcha id');
			 //var profile = document.getElementsByTagName('h4')[1].innerText;
			 var profile = 'DOCBAO';
			 if(profile !== '')
				 GM_xmlhttpRequest({
					 method: "GET",
					 //url: "https://ocr.captchaai.com/in.php?key=85083ad522956ca65957407c945ed11d&method=hcaptcha&sitekey=5cb93c93-ed2d-4f52-bcbb-9a896cc6b071&pageurl=https://my.dropz.xyz/member/check-point?redirect=http%3A%2F%2Fmy.dropz.xyz%2Fmember%2Ftask%2Fsitefriends",
					 url:'http://localhost:8090/Captcha?profile=' + profile,
					 headers: {
						 "Content-Type": "application/json"
					 },
					 onload: function(response) {
						  console.log('send captcha id response ' + response.responseText);
						 var resText = response.responseText;
						 if(resText.includes('OK|')){
							 idCaptcha = resText.replace('OK|','');
						 }
						 else 
							idCaptcha = resText;
					 }
				 });
         }
    }
}


var hCaptchaResponse = '';
function getCaptchaResponse(){
    console.log('id captcha = '+ idCaptcha);
    if(idCaptcha !== ''){
        console.log('get captcha response of id ' + idCaptcha);
        GM_xmlhttpRequest({
                 method: "GET",
                 //url: "https://ocr.captchaai.com/res.php?key=85083ad522956ca65957407c945ed11d&action=get&id=" + idCaptcha,
				 url:'http://localhost:8090/Response?captchaTask=' + idCaptcha,
                 headers: {
                     "Content-Type": "application/json"
                 },
                 onload: function(response) {
                      console.log('captcha response ' + response.responseText);
                     var resText = response.responseText;
                     if(resText === 'CAPTCHA_NOT_READY'){
                     }
                     else if(resText.includes('OK|')){
                         hCaptchaResponse = resText.replace('OK|','');
                         idCaptcha = '';
                     }else{
						hCaptchaResponse = resText;
                         idCaptcha = '';
                     }
                 }
             });
    }
}

function solveCaptcha(){
     var hcaptchaNode = document.querySelector("textarea[name='h-captcha-response']");
    if (hcaptchaNode){
        console.log('solve captcha');
        if(hCaptchaResponse !== ''){
            document.querySelector("textarea[name='h-captcha-response']").value = hCaptchaResponse;
            document.querySelector("textarea[name='g-recaptcha-response']").value = hCaptchaResponse;
            hCaptchaResponse = '';
			idCaptcha = '';
            document.querySelector("button[class='btn btn-block btn-danger text-light auth-form-btn']").click();
        }
    }
}

function clickOther(){
	var targetNode = document.querySelector("button[class='swal-button swal-button--confirm']");
    if (targetNode) {
            triggerMouseEvent (targetNode, "mouseover");
            triggerMouseEvent (targetNode, "mousedown");
            triggerMouseEvent (targetNode, "mouseup");
            triggerMouseEvent (targetNode, "click");
    }
    else{
        
    }
	try{
	var profile1 = document.getElementsByTagName('h4')[1].innerText;
	if(profile === '' && profile1 !== ''){
		profile = profile1;
	}
	}catch(exxx)
	{}
	console.log(' profile ', profile);
}
function triggerMouseEvent (node, eventType) {
        var clickEvent = new Event(eventType, { bubbles: true, cancelable: true });
        node.dispatchEvent (clickEvent);
}

